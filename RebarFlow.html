<!DOCTYPE html>
<html lang="pt-br">
<!-- 
 * SOFTWARE: RebarFlow 2025
 * AUTOR: Eng. José Carlos Barreto Filho
 * COPYRIGHT: © 2025 José Carlos Barreto Filho. Todos os direitos reservados.
 * 
 * LICENÇA: USO PROPRIETÁRIO E PRIVADO.
 * É estritamente proibida a cópia, modificação, redistribuição ou uso comercial 
 * deste código sem a autorização expressa e por escrito do titular dos direitos.
 * Protegido pela Lei de Software (Lei nº 9.609/98) e Lei de Direitos Autorais (Lei nº 9.610/98).
-->
<head>
    <meta charset="UTF-8">
    <title>RebarFlow 2025 - Eng. José Carlos Barreto Filho</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', sans-serif; background: #0f0f0f; color: white; }
        canvas { display: block; cursor: crosshair; }
        
        .panel { 
            position: absolute; top: 20px; left: 20px; 
            background: rgba(25, 25, 25, 0.98); padding: 22px; border-radius: 12px; 
            border: 1px solid #444; width: 290px; box-shadow: 0 20px 40px rgba(0,0,0,0.7); z-index: 100;
        }

        h2 { font-size: 18px; margin: 0 0 15px 0; color: #00bcff; border-bottom: 1px solid #333; padding-bottom: 10px; font-weight: 600; }
        
        .input-group { margin-bottom: 12px; display: flex; flex-direction: column; gap: 5px; }
        label { font-size: 11px; color: #888; font-weight: bold; text-transform: uppercase; }
        
        input, select, button { 
            padding: 10px; border-radius: 6px; border: 1px solid #333; 
            background: #1a1a1a; color: white; font-size: 13px; outline: none;
        }

        .row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

        button { cursor: pointer; font-weight: bold; border: none; transition: 0.3s; margin-top: 5px; }
        .btn-draw { background: #007bff; color: white; }
        .btn-draw:hover { background: #0056b3; transform: scale(1.02); }
        
        .stats { 
            margin-top: 15px; padding: 12px; background: #151515; border-radius: 6px; 
            font-size: 13px; border-left: 4px solid #00ff00;
        }
        b { color: #00ff00; font-family: 'Courier New', monospace; }

        .footer {
            position: absolute; bottom: 15px; width: 100%; text-align: center;
            font-size: 11px; color: #555; pointer-events: none; text-transform: uppercase;
        }
    </style>
</head>
<body>

<div class="panel">
    <h2>RebarFlow 2025</h2>
    
    <div class="input-group">
        <label>Comprimento Reto (m)</label>
        <input type="number" id="inpComprimento" step="0.01" value="2.50">
    </div>

    <div class="row">
        <div class="input-group">
            <label>Gancho (cm)</label>
            <input type="number" id="inpGancho" step="1" value="12">
        </div>
        <div class="input-group">
            <label>Bitola (Ø)</label>
            <select id="selBitola">
                <option value="6.3" data-peso="0.245">6.3 mm</option>
                <option value="8.0" data-peso="0.395">8.0 mm</option>
                <option value="10.0" data-peso="0.617" selected>10.0 mm</option>
                <option value="12.5" data-peso="0.963">12.5 mm</option>
                <option value="16.0" data-peso="1.578">16.0 mm</option>
                <option value="20.0" data-peso="2.466">20.0 mm</option>
            </select>
        </div>
    </div>

    <button class="btn-draw" onclick="desenharPeca()">GERAR E CENTRALIZAR</button>
    
    <div class="stats">
        Comprimento: <b id="totalM">0.00</b> m<br>
        Peso CA-50: <b id="totalKg">0.00</b> kg
    </div>

    <button style="width: 100%; background: #333; margin-top: 10px;" onclick="limpar()">Limpar</button>
    <button style="width: 100%; background: #28a745; margin-top: 5px;" onclick="exportarDXF()">Exportar (.DXF)</button>
</div>

<div class="footer">
    © 2025 Eng. José Carlos Barreto Filho • Software sob Licença Proprietária
</div>

<canvas id="cadCanvas"></canvas>

<script>
    const canvas = document.getElementById('cadCanvas');
    const ctx = canvas.getContext('2d');
    const ESCALA = 120; 
    let armaduras = [];

    function redimensionar() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        renderizar();
    }

    function desenharPeca() {
        const compReto = parseFloat(document.getElementById('inpComprimento').value);
        const ganchoCm = parseFloat(document.getElementById('inpGancho').value) || 0;
        const ganchoM = ganchoCm / 100;
        
        if (!compReto || compReto <= 0) return;

        const opt = document.getElementById('selBitola').options[document.getElementById('selBitola').selectedIndex];
        
        // Centralização
        armaduras = []; 
        const xMid = canvas.width / 2;
        const yMid = canvas.height / 2;
        const x1 = xMid - (compReto * ESCALA / 2);
        const x2 = xMid + (compReto * ESCALA / 2);

        armaduras.push({
            x1, y1: yMid, x2, y2: yMid,
            compReto, ganchoM,
            compTotal: compReto + (2 * ganchoM),
            bitola: opt.value,
            pesoLinear: parseFloat(opt.dataset.peso)
        });

        atualizarTotais();
        renderizar();
    }

    function atualizarTotais() {
        let totalM = 0, totalKg = 0;
        armaduras.forEach(a => {
            totalM += a.compTotal;
            totalKg += a.compTotal * a.pesoLinear;
        });
        document.getElementById('totalM').innerText = totalM.toFixed(2);
        document.getElementById('totalKg').innerText = totalKg.toFixed(2);
    }

    function renderizar() {
        ctx.fillStyle = "#0f0f0f";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // Grid Técnico
        ctx.strokeStyle = "#1a1a1a";
        ctx.lineWidth = 1;
        ctx.beginPath();
        for(let i=0; i<canvas.width; i+=40) { ctx.moveTo(i,0); ctx.lineTo(i,canvas.height); }
        for(let i=0; i<canvas.height; i+=40) { ctx.moveTo(0,i); ctx.lineTo(canvas.width,i); }
        ctx.stroke();

        armaduras.forEach(a => {
            ctx.shadowBlur = 10;
            ctx.shadowColor = "#ff6b1a";
            ctx.strokeStyle = "#ff6b1a";
            ctx.lineWidth = Math.max(4, a.bitola / 2);
            ctx.lineJoin = "round";
            
            const gPx = a.ganchoM * ESCALA;
            ctx.beginPath();
            ctx.moveTo(a.x1, a.y1 - gPx);
            ctx.lineTo(a.x1, a.y1);
            ctx.lineTo(a.x2, a.y2);
            ctx.lineTo(a.x2, a.y2 - gPx);
            ctx.stroke();
            
            ctx.shadowBlur = 0;
            ctx.fillStyle = "#fff";
            ctx.font = "bold 14px Segoe UI";
            ctx.textAlign = "center";
            ctx.fillText(`Ø ${a.bitola} mm`, (a.x1+a.x2)/2, a.y1 - gPx - 25);
            ctx.fillStyle = "#00bcff";
            ctx.fillText(`${a.compReto}m`, (a.x1+a.x2)/2, a.y1 + 25);
        });
    }

    function exportarDXF() {
        if (armaduras.length === 0) return;
        let dxf = "0\nSECTION\n2\nENTITIES\n";
        armaduras.forEach(a => {
            const x1 = (a.x1/ESCALA).toFixed(3);
            const y1 = (a.y1/ESCALA).toFixed(3);
            const x2 = (a.x2/ESCALA).toFixed(3);
            const y2 = (a.y2/ESCALA).toFixed(3);
            const gM = a.ganchoM;
            dxf += `0\nLINE\n8\nREBAR\n10\n${x1}\n20\n${y1}\n11\n${x1}\n21\n${parseFloat(y1)+gM}\n`;
            dxf += `0\nLINE\n8\nREBAR\n10\n${x1}\n20\n${y1}\n11\n${x2}\n21\n${y2}\n`;
            dxf += `0\nLINE\n8\nREBAR\n10\n${x2}\n20\n${y2}\n11\n${x2}\n21\n${parseFloat(y2)+gM}\n`;
        });
        dxf += "0\nENDSEC\n0\nEOF";
        const link = document.createElement('a');
        link.href = URL.createObjectURL(new Blob([dxf], {type:'application/dxf'}));
        link.download = `RebarFlow_Eng_Barreto.dxf`;
        link.click();
    }

    function limpar() { armaduras = []; atualizarTotais(); renderizar(); }
    window.addEventListener('resize', redimensionar);
    redimensionar();
</script>

</body>
</html>
