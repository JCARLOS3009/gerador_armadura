<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>RebarFlow 2025 - Eng. José Carlos Barreto Filho</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', Tahoma, sans-serif; background: #121212; color: white; }
        canvas { display: block; cursor: crosshair; }
        
        /* Painel Lateral */
        .panel { 
            position: absolute; top: 20px; left: 20px; 
            background: rgba(28, 28, 28, 0.95); padding: 20px; border-radius: 12px; 
            border: 1px solid #3d3d3d; width: 280px; box-shadow: 0 15px 35px rgba(0,0,0,0.6); z-index: 100;
        }

        h2 { font-size: 18px; margin: 0 0 15px 0; color: #00bcff; letter-spacing: 1px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        
        .input-group { margin-bottom: 12px; display: flex; flex-direction: column; gap: 5px; }
        label { font-size: 11px; color: #888; font-weight: bold; text-transform: uppercase; }
        
        input, select, button { 
            padding: 10px; border-radius: 6px; border: 1px solid #333; 
            background: #222; color: white; font-size: 13px; outline: none;
        }

        input:focus { border-color: #00bcff; }

        .row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

        button { cursor: pointer; font-weight: bold; border: none; transition: 0.3s; margin-top: 5px; }
        .btn-draw { background: #007bff; color: white; box-shadow: 0 4px 10px rgba(0,123,255,0.3); }
        .btn-draw:hover { background: #0056b3; transform: translateY(-1px); }
        
        .stats { 
            margin-top: 20px; padding: 12px; background: #1a1a1a; border-radius: 6px; 
            font-size: 13px; border-left: 4px solid #00ff00; line-height: 1.6;
        }
        b { color: #00ff00; font-family: 'Consolas', monospace; font-size: 14px; }

        /* Rodapé de Direitos Autorais */
        .footer {
            position: absolute; bottom: 15px; width: 100%; text-align: center;
            font-size: 11px; color: #666; letter-spacing: 0.5px; pointer-events: none;
        }
        .footer strong { color: #888; }
    </style>
</head>
<body>

<div class="panel">
    <h2>RebarFlow 2025</h2>
    
    <div class="input-group">
        <label>Comprimento Reto (m)</label>
        <input type="number" id="inpComprimento" step="0.01" value="2.00">
    </div>

    <div class="row">
        <div class="input-group">
            <label>Gancho (cm)</label>
            <input type="number" id="inpGancho" step="1" value="10">
        </div>
        <div class="input-group">
            <label>Bitola (Ø)</label>
            <select id="selBitola">
                <option value="6.3" data-peso="0.245">6.3 mm</option>
                <option value="8.0" data-peso="0.395">8.0 mm</option>
                <option value="10.0" data-peso="0.617" selected>10.0 mm</option>
                <option value="12.5" data-peso="0.963">12.5 mm</option>
                <option value="16.0" data-peso="1.578">16.0 mm</option>
                <option value="20.0" data-peso="2.466">20.0 mm</option>
            </select>
        </div>
    </div>

    <button class="btn-draw" onclick="desenharCentralizado()">GERAR DETALHAMENTO</button>
    
    <div class="stats">
        Comp. Total: <b id="totalM">0.00</b> m<br>
        Peso (CA-50): <b id="totalKg">0.00</b> kg
    </div>

    <button style="width: 100%; background: #333; margin-top: 10px;" onclick="limpar()">Limpar Tela</button>
    <button style="width: 100%; background: #28a745; margin-top: 5px;" onclick="exportarDXF()">Exportar DXF</button>
</div>

<div class="footer">
    © 2025 Desenvolvido por <strong>Eng. José Carlos Barreto Filho</strong> • Todos os direitos reservados.
</div>

<canvas id="cadCanvas"></canvas>

<script>
    const canvas = document.getElementById('cadCanvas');
    const ctx = canvas.getContext('2d');
    const ESCALA = 120; // Aumentado um pouco para melhor visibilidade
    let armaduras = [];

    function redimensionar() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        renderizar();
    }

    function desenharCentralizado() {
        const compReto = parseFloat(document.getElementById('inpComprimento').value);
        const ganchoCm = parseFloat(document.getElementById('inpGancho').value) || 0;
        const ganchoM = ganchoCm / 100;
        
        if (!compReto || compReto <= 0) return alert("Por favor, insira um comprimento válido.");

        const opt = document.getElementById('selBitola').options[document.getElementById('selBitola').selectedIndex];
        
        // Limpa para manter foco na peça atual centralizada
        armaduras = []; 

        // Cálculo do Centro
        const xMid = canvas.width / 2;
        const yMid = canvas.height / 2;
        
        const x1 = xMid - (compReto * ESCALA / 2);
        const x2 = xMid + (compReto * ESCALA / 2);

        armaduras.push({
            x1, y1: yMid, x2, y2: yMid,
            compReto, ganchoM,
            compTotal: compReto + (2 * ganchoM),
            bitola: opt.value,
            pesoLinear: parseFloat(opt.dataset.peso)
        });

        atualizarTotais();
        renderizar();
    }

    function atualizarTotais() {
        let totalM = 0, totalKg = 0;
        armaduras.forEach(a => {
            totalM += a.compTotal;
            totalKg += a.compTotal * a.pesoLinear;
        });
        document.getElementById('totalM').innerText = totalM.toFixed(2);
        document.getElementById('totalKg').innerText = totalKg.toFixed(2);
    }

    function renderizar() {
        ctx.fillStyle = "#121212";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // Desenhar Grid de Engenharia
        ctx.strokeStyle = "#1e1e1e";
        ctx.lineWidth = 1;
        ctx.beginPath();
        for(let i=0; i<canvas.width; i+=40) { ctx.moveTo(i,0); ctx.lineTo(i,canvas.height); }
        for(let i=0; i<canvas.height; i+=40) { ctx.moveTo(0,i); ctx.lineTo(canvas.width,i); }
        ctx.stroke();

        armaduras.forEach(a => {
            // Sombra para efeito 3D
            ctx.shadowBlur = 15;
            ctx.shadowColor = "rgba(255, 107, 26, 0.4)";
            
            ctx.strokeStyle = "#ff6b1a";
            ctx.lineWidth = Math.max(4, a.bitola / 2);
            ctx.lineCap = "round";
            ctx.lineJoin = "round";
            
            const gPx = a.ganchoM * ESCALA;

            ctx.beginPath();
            // Desenho da barra em U (Ganchos para cima)
            ctx.moveTo(a.x1, a.y1 - gPx);
            ctx.lineTo(a.x1, a.y1);
            ctx.lineTo(a.x2, a.y2);
            ctx.lineTo(a.x2, a.y2 - gPx);
            ctx.stroke();
            
            ctx.shadowBlur = 0; // Remove sombra para textos

            // Rótulos Técnicos
            ctx.fillStyle = "#ffffff";
            ctx.font = "bold 14px Segoe UI";
            ctx.textAlign = "center";
            ctx.fillText(`Ø ${a.bitola} mm`, (a.x1+a.x2)/2, a.y1 - gPx - 30);
            
            ctx.fillStyle = "#00bcff";
            ctx.fillText(`${a.compReto}m`, (a.x1+a.x2)/2, a.y1 + 30);
            
            if(a.ganchoM > 0) {
                ctx.font = "11px Consolas";
                ctx.fillStyle = "#888";
                ctx.fillText(`${(a.ganchoM*100).toFixed(0)}cm`, a.x1 - 35, a.y1 - gPx/2);
                ctx.fillText(`${(a.ganchoM*100).toFixed(0)}cm`, a.x2 + 35, a.y1 - gPx/2);
            }
        });
    }

    function exportarDXF() {
        if (armaduras.length === 0) return;
        let dxf = "0\nSECTION\n2\nENTITIES\n";
        armaduras.forEach(a => {
            const x1 = (a.x1/ESCALA).toFixed(3);
            const y1 = (a.y1/ESCALA).toFixed(3);
            const x2 = (a.x2/ESCALA).toFixed(3);
            const y2 = (a.y2/ESCALA).toFixed(3);
            const gM = a.ganchoM;
            
            // Exporta as 3 partes do vergalhão
            dxf += `0\nLINE\n8\nREBAR\n10\n${x1}\n20\n${y1}\n11\n${x1}\n21\n${parseFloat(y1)+gM}\n`;
            dxf += `0\nLINE\n8\nREBAR\n10\n${x1}\n20\n${y1}\n11\n${x2}\n21\n${y2}\n`;
            dxf += `0\nLINE\n8\nREBAR\n10\n${x2}\n20\n${y2}\n11\n${x2}\n21\n${parseFloat(y2)+gM}\n`;
        });
        dxf += "0\nENDSEC\n0\nEOF";
        const link = document.createElement('a');
        link.href = URL.createObjectURL(new Blob([dxf], {type:'application/dxf'}));
        link.download = `RebarFlow_Export.dxf`;
        link.click();
    }

    function limpar() { armaduras = []; atualizarTotais(); renderizar(); }
    window.addEventListener('resize', redimensionar);
    redimensionar();
</script>

</body>
</html>
